<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="/assets/fonts/economica/font.css"/><link rel="stylesheet" href="/assets/fonts/palanquin/font.css"/><script type="text/javascript" src="/assets/js/darkmode.js"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@foosel"/><meta name="twitter:creator" content="@foosel"/><meta property="og:locale" content="en"/><meta property="og:site_name" content="foosel.net"/><title>TFA Dostmann meets ESPHome | foosel.net</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Integrating a CO2 sensor into my HA setup"/><meta property="og:title" content="TFA Dostmann meets ESPHome"/><meta property="og:description" content="Integrating a CO2 sensor into my HA setup"/><meta property="og:url" content="https://foosel.net/blog/2022-01-03-tfa-dostmann-meets-esphome"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2022-01-03T00:00:00Z"/><meta property="article:modified_time" content="2022-01-03T00:00:00Z"/><meta property="og:image" content="https://foosel.net/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg"/><meta property="og:image:alt" content="A TFA Dostmann CO2 sensor"/><meta name="next-head-count" content="19"/><link rel="preload" href="/_next/static/css/99f79fd98d542b376485.css" as="style"/><link rel="stylesheet" href="/_next/static/css/99f79fd98d542b376485.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-fb76148cfcfb42ca18eb.js" defer=""></script><script src="/_next/static/chunks/framework-1a85486469afb3278dba.js" defer=""></script><script src="/_next/static/chunks/main-c5c678ba45d45bf9d8f5.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b2bb00fb52e744f9e33e.js" defer=""></script><script src="/_next/static/chunks/465-9050204e68dafc3e13af.js" defer=""></script><script src="/_next/static/chunks/804-48023baaccf128bb1e47.js" defer=""></script><script src="/_next/static/chunks/154-4cdb215d6f6cb7ee3ca8.js" defer=""></script><script src="/_next/static/chunks/608-a6bd458a362b3c911e0b.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-4562f9736860a1374870.js" defer=""></script><script src="/_next/static/NB2AQ2KTkRyobXE-4BysK/_buildManifest.js" defer=""></script><script src="/_next/static/NB2AQ2KTkRyobXE-4BysK/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="flex flex-col min-h-screen"><nav class="fixed bg-black text-white p-4 w-full z-50"><div class="w-screen-sm xl:w-screen-md lg:mx-auto flex flex-col lg:flex-row content-end lg:justify-center"><div class="flex flex-row lg:absolute lg:left-4"><span class="justify-start"><a class="text-white uppercase font-semibold" href="/">foosel.net</a></span></div><div class="absolute right-4"><a class="justify-end hidden lg:inline" title="Toggle dark mode"><svg class="mdi-icon inline cursor-pointer" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"></path></svg></a><span class="flex flex-row justify-end lg:hidden cursor-pointer"><div><svg class="mdi-icon " width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"></path></svg></div></span></div><ul class="flex-col mt-2 lg:mt-0 text-right lg:text-center lg:flex lg:flex-row lg:justify-end hidden"><li class="my-2 lg:my-0 lg:mx-4"><a class="text-white uppercase font-semibold" href="/">Home</a></li><li class="my-2 lg:my-0 lg:mx-4"><a class="text-white uppercase font-semibold" href="/about">About Me</a></li><li class="my-2 lg:my-0 lg:mx-4"><a class="text-white uppercase font-semibold" href="/blog">Blog</a></li><li class="my-2 lg:my-0 lg:mx-4"><a class="text-white uppercase font-semibold" href="/media">Media</a></li><li class="lg:hidden my-2"><a class="text-white uppercase font-semibold" title="Toggle dark mode"><svg class="mdi-icon inline cursor-pointer" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M12,18V6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,15.31L23.31,12L20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31Z"></path></svg></a></li></ul></div></nav><main class="container flex-grow mx-auto justify-content py-4 pt-20"><div class="flex flex-col max-w-screen-sm xl:max-w-screen-md mx-auto justify-content"><div class="flex flex-col space-y-4 mb-4"><h1 class="text-6xl md:text-7xl lg:text-8xl font-bold tracking-tighter text-center">TFA Dostmann meets ESPHome</h1><p class="text-3xl md:text-4xl lg:text-5xl text-center">Integrating a CO2 sensor into my HA setup</p><p class="italic text-center">Posted on<!-- --> <time dateTime="2022-01-03T00:00:00Z">January	3, 2022</time></p><p class="text-center text-xs"><svg class="mdi-icon inline-block object-center" width="12" height="12" fill="currentColor" viewBox="0 0 24 24"><path d="M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"></path></svg> <!-- -->4 min read</p><img src="/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg" alt="A TFA Dostmann CO2 sensor" class="w-full"/></div><div class="flex flex-col w-full px-4 mt-8"><article class="prose lg:prose-xl w-full mx-auto"><div><p>I attended RC3 from December 27th until December 30th. While it was (once again)
only a virtual edition of the Chaos Communication Congress, at least this time
around I managed to have a similar experience to 36c3, as in, I spent the last two days
mostly hanging out with a bunch of fellow geeks in a fun location (a jitsi conference
that also included a camera pointing at an aquarium full of fish) and nerding out
while tinkering around with electronics.</p><p>And thus I finally integrated the CO2 sensor unit I bought a couple weeks ago into
my Home Automation setup, with the help of a Wemos D1 Mini and <a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://esphome.io">ESPHome</a>. At first
I went with an ESP12, a voltage regulator and a <a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://github.com/schinken/esp8266-co2monitor">different firmware</a>,
but that didn&#x27;t work out due to the ESP not wanting to behave (my guess is I didn&#x27;t wire the barebone module
up correctly or the voltage regulator was causing issues) and I also got some weird readings
reported by the firmware (20k ppm CO2 - I know the air in my office can get bad after a couple of hours of
coding, but not THAT bad).</p><p>The CO2 sensor is an &quot;AIRCO2NTROL MINI&quot; from TFA Dostmann, but it is also available under other names
with a very similar case and more or less the same internals, as I learned from the
<a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://esphome.io/components/sensor/zyaura.html">ESPHome docs</a>. Where my Dostmann edition seems to differ from the majority is the
pin order of the internal debug port, which turned out to have CLK and DATA swapped
in my case, which caused me quite the headache and a bit of frustration. So just for future reference,
the pin order I found in my device is 5V - Data - CLK - Gnd from left to right with the hose to the left:</p><p><img pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" src="/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-pinout.jpg" alt="The pinout of the sensor&#x27;s debug port, 5V - Data - CLK - Gnd"/></p><p>I hooked these up to the Wemos D1 Mini (clone) like this:</p><p><img pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" src="/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-wemos-d1-wiring.png" alt="A wiring diagram of how to hookup the Wemos D1 mini to the debug port, 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2"/></p><p>So 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2.</p><p>The ESPHome config I then flashed to the D1 is the following:</p><pre><code class="language-yaml">esphome:
  name: dostmann-office
  platform: ESP8266
  board: d1_mini

logger:

mqtt:
  broker: !secret mqtt_iot_broker

ota:
  password: !secret ota_pass

wifi:
  ssid: !secret wifi_iot_ssid
  password: !secret wifi_iot_pass
  ap:
    ssid: &quot;Dostmann Office Fallback&quot;
    password: !secret fallback_pass
  power_save_mode: high

captive_portal:

sensor:
  - platform: zyaura
    clock_pin: D2
    data_pin: D1
    co2:
      name: &quot;Office Dostmann CO2&quot;
    temperature:
      name: &quot;Office Dostmann Temperature&quot;

  - platform: wifi_signal
    name: &quot;Office Dostmann WiFi Signal&quot;
    update_interval: 60s
</code></pre><p>(If you are wondering about the <code>!secret</code> stuff, those values are contained in
a <code>secret.yaml</code> file in my esphome folder, and you can read all about that
<a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://esphome.io/guides/faq.html#tips-for-using-esphome">in the ESPHome docs here</a>.)</p><p>And with that I could now see the sensor in my Home Assistant instance and forward the data
easily to my InfluxDB &amp; Grafana monitoring stack.</p><p>To put everything together physically, fully contained, I used <a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://www.thingiverse.com/thing:4225732">this alternative backplate</a>
by Stefan Kern. </p><p><img pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" src="/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-back.jpg" alt="The alternative backplate in place, closing up the sensor and containing the Wemos D1 Mini as well"/></p><p>However, I&#x27;ve noticed a temperature increase of around 3°C with it and the ESP
in place, and I fear this might be screwing with the CO2 sensor&#x27;s calibration (as the measurement
is temperature sensitive). I already mitigated this a bit by setting the chip to power save and adding some strategically placed aluminium tape,
but that&#x27;s only improved things slightly. Due to that I plan to redesign the
backplate to have the ESP outside the sensor case, in its own compartment. I
hope that will solve the &quot;running hot&quot; issue for good then, but we&#x27;ll see.</p><p><em>Update from January 27th 2022</em> I redesigned the backplate and now have a solution that seems to work better, based on the reported temperature and CO2. <a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://www.prusaprinters.org/prints/119968-airco2ntrol-mini-backplate-with-wemos-d1-mini">I&#x27;ve published it here</a>.</p><p>In any case, for now I at least got a reliable indicator of my office&#x27;s CO2 levels that also now
are trackable long term, and I have also forwarded the current values to my <a pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" href="https://awtrixdocs.blueforcer.de/">AWTRIX mini</a>
via some NodeRED flow that also takes care of color coding. Further possibilities include
flashing the office lights or some audio cues, should just the visual warning turn out
to be insufficient in the long term 😉</p><p><img pathname="/blog/2022-01-03-tfa-dostmann-meets-esphome" src="/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/grafana-co2.png" alt="CO2 sensor data graphed over two days"/></p></div></article><p class="flex flex-row mt-6 text-inherit text-sm"><span class="flex-1"></span><a href="/blog/2021-09-28-being-patient-with-yourself-is-hard">Being patient with yourself is hard →</a></p></div></div></main><footer class="p-4 bg-black text-white"><div class="max-w-screen-sm xl:max-w-screen-md mx-auto flex flex-col"><p class="text-white text-center">Made with ❤ by<!-- --> <a href="/about">Gina Häußge</a></p><p class="text-white text-center"><a href="/legal">Legal Notice</a> ·<!-- --> <a href="/privacy">Privacy Policy</a> ·<!-- --> <a href="/feed/blog.atom">Feed</a></p></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"2022-01-03-tfa-dostmann-meets-esphome","title":"TFA Dostmann meets ESPHome","subtitle":"Integrating a CO2 sensor into my HA setup","image":{"url":"/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg","alt":"A TFA Dostmann CO2 sensor","external":"https://foosel.net/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg"},"content":"\nI attended RC3 from December 27th until December 30th. While it was (once again)\nonly a virtual edition of the Chaos Communication Congress, at least this time\naround I managed to have a similar experience to 36c3, as in, I spent the last two days\nmostly hanging out with a bunch of fellow geeks in a fun location (a jitsi conference\nthat also included a camera pointing at an aquarium full of fish) and nerding out\nwhile tinkering around with electronics.\n\nAnd thus I finally integrated the CO2 sensor unit I bought a couple weeks ago into\nmy Home Automation setup, with the help of a Wemos D1 Mini and [ESPHome](https://esphome.io). At first\nI went with an ESP12, a voltage regulator and a [different firmware](https://github.com/schinken/esp8266-co2monitor),\nbut that didn't work out due to the ESP not wanting to behave (my guess is I didn't wire the barebone module\nup correctly or the voltage regulator was causing issues) and I also got some weird readings \nreported by the firmware (20k ppm CO2 - I know the air in my office can get bad after a couple of hours of\ncoding, but not THAT bad).\n\nThe CO2 sensor is an \"AIRCO2NTROL MINI\" from TFA Dostmann, but it is also available under other names\nwith a very similar case and more or less the same internals, as I learned from the\n[ESPHome docs](https://esphome.io/components/sensor/zyaura.html). Where my Dostmann edition seems to differ from the majority is the\npin order of the internal debug port, which turned out to have CLK and DATA swapped\nin my case, which caused me quite the headache and a bit of frustration. So just for future reference,\nthe pin order I found in my device is 5V - Data - CLK - Gnd from left to right with the hose to the left:\n\n![The pinout of the sensor's debug port, 5V - Data - CLK - Gnd](./tfa-dostmann-pinout.jpg)\n\nI hooked these up to the Wemos D1 Mini (clone) like this:\n\n![A wiring diagram of how to hookup the Wemos D1 mini to the debug port, 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2](./tfa-dostmann-wemos-d1-wiring.png)\n\nSo 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2.\n\nThe ESPHome config I then flashed to the D1 is the following:\n\n``` yaml\nesphome:\n  name: dostmann-office\n  platform: ESP8266\n  board: d1_mini\n\nlogger:\n\nmqtt:\n  broker: !secret mqtt_iot_broker\n\nota:\n  password: !secret ota_pass\n\nwifi:\n  ssid: !secret wifi_iot_ssid\n  password: !secret wifi_iot_pass\n  ap:\n    ssid: \"Dostmann Office Fallback\"\n    password: !secret fallback_pass\n  power_save_mode: high\n\ncaptive_portal:\n\nsensor:\n  - platform: zyaura\n    clock_pin: D2\n    data_pin: D1\n    co2:\n      name: \"Office Dostmann CO2\"\n    temperature:\n      name: \"Office Dostmann Temperature\"\n\n  - platform: wifi_signal\n    name: \"Office Dostmann WiFi Signal\"\n    update_interval: 60s\n```\n\n(If you are wondering about the `!secret` stuff, those values are contained in \na `secret.yaml` file in my esphome folder, and you can read all about that\n[in the ESPHome docs here](https://esphome.io/guides/faq.html#tips-for-using-esphome).)\n\nAnd with that I could now see the sensor in my Home Assistant instance and forward the data\neasily to my InfluxDB \u0026 Grafana monitoring stack.\n\nTo put everything together physically, fully contained, I used [this alternative backplate](https://www.thingiverse.com/thing:4225732)\nby Stefan Kern. \n\n![The alternative backplate in place, closing up the sensor and containing the Wemos D1 Mini as well](./tfa-dostmann-back.jpg)\n\nHowever, I've noticed a temperature increase of around 3°C with it and the ESP\nin place, and I fear this might be screwing with the CO2 sensor's calibration (as the measurement\nis temperature sensitive). I already mitigated this a bit by setting the chip to power save and adding some strategically placed aluminium tape,\nbut that's only improved things slightly. Due to that I plan to redesign the \nbackplate to have the ESP outside the sensor case, in its own compartment. I \nhope that will solve the \"running hot\" issue for good then, but we'll see.\n\n*Update from January 27th 2022* I redesigned the backplate and now have a solution that seems to work better, based on the reported temperature and CO2. [I've published it here](https://www.prusaprinters.org/prints/119968-airco2ntrol-mini-backplate-with-wemos-d1-mini).\n\nIn any case, for now I at least got a reliable indicator of my office's CO2 levels that also now\nare trackable long term, and I have also forwarded the current values to my [AWTRIX mini](https://awtrixdocs.blueforcer.de/)\nvia some NodeRED flow that also takes care of color coding. Further possibilities include\nflashing the office lights or some audio cues, should just the visual warning turn out\nto be insufficient in the long term 😉\n\n![CO2 sensor data graphed over two days](./grafana-co2.png)\n","assets":[{"slug":"2022-01-03-tfa-dostmann-meets-esphome","asset":"grafana-co2.png","path":"/home/runner/work/foosel.github.io/foosel.github.io/content/posts/2022-01-03-tfa-dostmann-meets-esphome/grafana-co2.png"},{"slug":"2022-01-03-tfa-dostmann-meets-esphome","asset":"tfa-dostmann-back.jpg","path":"/home/runner/work/foosel.github.io/foosel.github.io/content/posts/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-back.jpg"},{"slug":"2022-01-03-tfa-dostmann-meets-esphome","asset":"tfa-dostmann-front.jpg","path":"/home/runner/work/foosel.github.io/foosel.github.io/content/posts/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg"},{"slug":"2022-01-03-tfa-dostmann-meets-esphome","asset":"tfa-dostmann-pinout.jpg","path":"/home/runner/work/foosel.github.io/foosel.github.io/content/posts/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-pinout.jpg"},{"slug":"2022-01-03-tfa-dostmann-meets-esphome","asset":"tfa-dostmann-wemos-d1-wiring.png","path":"/home/runner/work/foosel.github.io/foosel.github.io/content/posts/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-wemos-d1-wiring.png"}],"published":"2022-01-03T00:00:00Z","readingtime":{"text":"4 min read","minutes":3.715,"time":222900,"words":743},"mdx":{"compiledSource":"\"use strict\";\n\nvar _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"I attended RC3 from December 27th until December 30th. While it was (once again)\\nonly a virtual edition of the Chaos Communication Congress, at least this time\\naround I managed to have a similar experience to 36c3, as in, I spent the last two days\\nmostly hanging out with a bunch of fellow geeks in a fun location (a jitsi conference\\nthat also included a camera pointing at an aquarium full of fish) and nerding out\\nwhile tinkering around with electronics.\"), mdx(\"p\", null, \"And thus I finally integrated the CO2 sensor unit I bought a couple weeks ago into\\nmy Home Automation setup, with the help of a Wemos D1 Mini and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://esphome.io\"\n  }, \"ESPHome\"), \". At first\\nI went with an ESP12, a voltage regulator and a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/schinken/esp8266-co2monitor\"\n  }, \"different firmware\"), \",\\nbut that didn't work out due to the ESP not wanting to behave (my guess is I didn't wire the barebone module\\nup correctly or the voltage regulator was causing issues) and I also got some weird readings\\nreported by the firmware (20k ppm CO2 - I know the air in my office can get bad after a couple of hours of\\ncoding, but not THAT bad).\"), mdx(\"p\", null, \"The CO2 sensor is an \\\"AIRCO2NTROL MINI\\\" from TFA Dostmann, but it is also available under other names\\nwith a very similar case and more or less the same internals, as I learned from the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://esphome.io/components/sensor/zyaura.html\"\n  }, \"ESPHome docs\"), \". Where my Dostmann edition seems to differ from the majority is the\\npin order of the internal debug port, which turned out to have CLK and DATA swapped\\nin my case, which caused me quite the headache and a bit of frustration. So just for future reference,\\nthe pin order I found in my device is 5V - Data - CLK - Gnd from left to right with the hose to the left:\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"./tfa-dostmann-pinout.jpg\",\n    \"alt\": \"The pinout of the sensor's debug port, 5V - Data - CLK - Gnd\"\n  })), mdx(\"p\", null, \"I hooked these up to the Wemos D1 Mini (clone) like this:\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"./tfa-dostmann-wemos-d1-wiring.png\",\n    \"alt\": \"A wiring diagram of how to hookup the Wemos D1 mini to the debug port, 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2\"\n  })), mdx(\"p\", null, \"So 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2.\"), mdx(\"p\", null, \"The ESPHome config I then flashed to the D1 is the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"esphome:\\n  name: dostmann-office\\n  platform: ESP8266\\n  board: d1_mini\\n\\nlogger:\\n\\nmqtt:\\n  broker: !secret mqtt_iot_broker\\n\\nota:\\n  password: !secret ota_pass\\n\\nwifi:\\n  ssid: !secret wifi_iot_ssid\\n  password: !secret wifi_iot_pass\\n  ap:\\n    ssid: \\\"Dostmann Office Fallback\\\"\\n    password: !secret fallback_pass\\n  power_save_mode: high\\n\\ncaptive_portal:\\n\\nsensor:\\n  - platform: zyaura\\n    clock_pin: D2\\n    data_pin: D1\\n    co2:\\n      name: \\\"Office Dostmann CO2\\\"\\n    temperature:\\n      name: \\\"Office Dostmann Temperature\\\"\\n\\n  - platform: wifi_signal\\n    name: \\\"Office Dostmann WiFi Signal\\\"\\n    update_interval: 60s\\n\")), mdx(\"p\", null, \"(If you are wondering about the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"!secret\"), \" stuff, those values are contained in\\na \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"secret.yaml\"), \" file in my esphome folder, and you can read all about that\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://esphome.io/guides/faq.html#tips-for-using-esphome\"\n  }, \"in the ESPHome docs here\"), \".)\"), mdx(\"p\", null, \"And with that I could now see the sensor in my Home Assistant instance and forward the data\\neasily to my InfluxDB \u0026 Grafana monitoring stack.\"), mdx(\"p\", null, \"To put everything together physically, fully contained, I used \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.thingiverse.com/thing:4225732\"\n  }, \"this alternative backplate\"), \"\\nby Stefan Kern. \"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"./tfa-dostmann-back.jpg\",\n    \"alt\": \"The alternative backplate in place, closing up the sensor and containing the Wemos D1 Mini as well\"\n  })), mdx(\"p\", null, \"However, I've noticed a temperature increase of around 3\\xB0C with it and the ESP\\nin place, and I fear this might be screwing with the CO2 sensor's calibration (as the measurement\\nis temperature sensitive). I already mitigated this a bit by setting the chip to power save and adding some strategically placed aluminium tape,\\nbut that's only improved things slightly. Due to that I plan to redesign the\\nbackplate to have the ESP outside the sensor case, in its own compartment. I\\nhope that will solve the \\\"running hot\\\" issue for good then, but we'll see.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Update from January 27th 2022\"), \" I redesigned the backplate and now have a solution that seems to work better, based on the reported temperature and CO2. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.prusaprinters.org/prints/119968-airco2ntrol-mini-backplate-with-wemos-d1-mini\"\n  }, \"I've published it here\"), \".\"), mdx(\"p\", null, \"In any case, for now I at least got a reliable indicator of my office's CO2 levels that also now\\nare trackable long term, and I have also forwarded the current values to my \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://awtrixdocs.blueforcer.de/\"\n  }, \"AWTRIX mini\"), \"\\nvia some NodeRED flow that also takes care of color coding. Further possibilities include\\nflashing the office lights or some audio cues, should just the visual warning turn out\\nto be insufficient in the long term \\uD83D\\uDE09\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"./grafana-co2.png\",\n    \"alt\": \"CO2 sensor data graphed over two days\"\n  })));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003eI attended RC3 from December 27th until December 30th. While it was (once again)\nonly a virtual edition of the Chaos Communication Congress, at least this time\naround I managed to have a similar experience to 36c3, as in, I spent the last two days\nmostly hanging out with a bunch of fellow geeks in a fun location (a jitsi conference\nthat also included a camera pointing at an aquarium full of fish) and nerding out\nwhile tinkering around with electronics.\u003c/p\u003e\u003cp\u003eAnd thus I finally integrated the CO2 sensor unit I bought a couple weeks ago into\nmy Home Automation setup, with the help of a Wemos D1 Mini and \u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://esphome.io\"\u003eESPHome\u003c/a\u003e. At first\nI went with an ESP12, a voltage regulator and a \u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://github.com/schinken/esp8266-co2monitor\"\u003edifferent firmware\u003c/a\u003e,\nbut that didn\u0026#x27;t work out due to the ESP not wanting to behave (my guess is I didn\u0026#x27;t wire the barebone module\nup correctly or the voltage regulator was causing issues) and I also got some weird readings\nreported by the firmware (20k ppm CO2 - I know the air in my office can get bad after a couple of hours of\ncoding, but not THAT bad).\u003c/p\u003e\u003cp\u003eThe CO2 sensor is an \u0026quot;AIRCO2NTROL MINI\u0026quot; from TFA Dostmann, but it is also available under other names\nwith a very similar case and more or less the same internals, as I learned from the\n\u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://esphome.io/components/sensor/zyaura.html\"\u003eESPHome docs\u003c/a\u003e. Where my Dostmann edition seems to differ from the majority is the\npin order of the internal debug port, which turned out to have CLK and DATA swapped\nin my case, which caused me quite the headache and a bit of frustration. So just for future reference,\nthe pin order I found in my device is 5V - Data - CLK - Gnd from left to right with the hose to the left:\u003c/p\u003e\u003cp\u003e\u003cimg pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" src=\"/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-pinout.jpg\" alt=\"The pinout of the sensor\u0026#x27;s debug port, 5V - Data - CLK - Gnd\"/\u003e\u003c/p\u003e\u003cp\u003eI hooked these up to the Wemos D1 Mini (clone) like this:\u003c/p\u003e\u003cp\u003e\u003cimg pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" src=\"/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-wemos-d1-wiring.png\" alt=\"A wiring diagram of how to hookup the Wemos D1 mini to the debug port, 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2\"/\u003e\u003c/p\u003e\u003cp\u003eSo 5V to 5V, Gnd to Gnd, Data to D1 and CLK to D2.\u003c/p\u003e\u003cp\u003eThe ESPHome config I then flashed to the D1 is the following:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eesphome:\n  name: dostmann-office\n  platform: ESP8266\n  board: d1_mini\n\nlogger:\n\nmqtt:\n  broker: !secret mqtt_iot_broker\n\nota:\n  password: !secret ota_pass\n\nwifi:\n  ssid: !secret wifi_iot_ssid\n  password: !secret wifi_iot_pass\n  ap:\n    ssid: \u0026quot;Dostmann Office Fallback\u0026quot;\n    password: !secret fallback_pass\n  power_save_mode: high\n\ncaptive_portal:\n\nsensor:\n  - platform: zyaura\n    clock_pin: D2\n    data_pin: D1\n    co2:\n      name: \u0026quot;Office Dostmann CO2\u0026quot;\n    temperature:\n      name: \u0026quot;Office Dostmann Temperature\u0026quot;\n\n  - platform: wifi_signal\n    name: \u0026quot;Office Dostmann WiFi Signal\u0026quot;\n    update_interval: 60s\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e(If you are wondering about the \u003ccode\u003e!secret\u003c/code\u003e stuff, those values are contained in\na \u003ccode\u003esecret.yaml\u003c/code\u003e file in my esphome folder, and you can read all about that\n\u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://esphome.io/guides/faq.html#tips-for-using-esphome\"\u003ein the ESPHome docs here\u003c/a\u003e.)\u003c/p\u003e\u003cp\u003eAnd with that I could now see the sensor in my Home Assistant instance and forward the data\neasily to my InfluxDB \u0026amp; Grafana monitoring stack.\u003c/p\u003e\u003cp\u003eTo put everything together physically, fully contained, I used \u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://www.thingiverse.com/thing:4225732\"\u003ethis alternative backplate\u003c/a\u003e\nby Stefan Kern. \u003c/p\u003e\u003cp\u003e\u003cimg pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" src=\"/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-back.jpg\" alt=\"The alternative backplate in place, closing up the sensor and containing the Wemos D1 Mini as well\"/\u003e\u003c/p\u003e\u003cp\u003eHowever, I\u0026#x27;ve noticed a temperature increase of around 3°C with it and the ESP\nin place, and I fear this might be screwing with the CO2 sensor\u0026#x27;s calibration (as the measurement\nis temperature sensitive). I already mitigated this a bit by setting the chip to power save and adding some strategically placed aluminium tape,\nbut that\u0026#x27;s only improved things slightly. Due to that I plan to redesign the\nbackplate to have the ESP outside the sensor case, in its own compartment. I\nhope that will solve the \u0026quot;running hot\u0026quot; issue for good then, but we\u0026#x27;ll see.\u003c/p\u003e\u003cp\u003e\u003cem\u003eUpdate from January 27th 2022\u003c/em\u003e I redesigned the backplate and now have a solution that seems to work better, based on the reported temperature and CO2. \u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://www.prusaprinters.org/prints/119968-airco2ntrol-mini-backplate-with-wemos-d1-mini\"\u003eI\u0026#x27;ve published it here\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eIn any case, for now I at least got a reliable indicator of my office\u0026#x27;s CO2 levels that also now\nare trackable long term, and I have also forwarded the current values to my \u003ca pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" href=\"https://awtrixdocs.blueforcer.de/\"\u003eAWTRIX mini\u003c/a\u003e\nvia some NodeRED flow that also takes care of color coding. Further possibilities include\nflashing the office lights or some audio cues, should just the visual warning turn out\nto be insufficient in the long term 😉\u003c/p\u003e\u003cp\u003e\u003cimg pathname=\"/blog/2022-01-03-tfa-dostmann-meets-esphome\" src=\"/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/grafana-co2.png\" alt=\"CO2 sensor data graphed over two days\"/\u003e\u003c/p\u003e","scope":{}}},"seo":{"title":"TFA Dostmann meets ESPHome","description":"Integrating a CO2 sensor into my HA setup","openGraph":{"title":"TFA Dostmann meets ESPHome","url":"https://foosel.net/blog/2022-01-03-tfa-dostmann-meets-esphome","description":"Integrating a CO2 sensor into my HA setup","images":[{"url":"https://foosel.net/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg","alt":"A TFA Dostmann CO2 sensor","external":"https://foosel.net/assets/content/blog/2022-01-03-tfa-dostmann-meets-esphome/tfa-dostmann-front.jpg"}],"type":"article","article":{"publishedTime":"2022-01-03T00:00:00Z","modifiedTime":"2022-01-03T00:00:00Z"}}},"previous":{"link":"/blog/2021-09-28-being-patient-with-yourself-is-hard","title":"Being patient with yourself is hard"},"next":null},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"2022-01-03-tfa-dostmann-meets-esphome"},"buildId":"NB2AQ2KTkRyobXE-4BysK","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>